= Memory Allocation

En este laboratorio veremos como analizar el uso de memoria.

1) Abrir una terminal y ejecutar

[source,bash]
----
./run.sh -l memory_allocation
----

2) Abrir JMC, buscar el proceso Java y conectar la consola JMX.

3) Seleccionar el tab _Memory_ y verificar que areas están creciendo.

4) Seleccionar el tab _Threads_ y hacer click en el checkbox _Allocation_ para ver que Thread esta alocando mas memoria.

5) A la hora de diagnosticar el correcto uso de memoria podemos usar multiples herramientas como `Histogramas`, `JFR`, `Heap Dumps`, `Old Object Sample (JDK 10+)`.

5.1) Histogramas

[source,bash]
----
./scripts/get_class_histograms.sh -p <PID> -c 6 -w 10 -o memory_allocation
----

5.2) JFR y Old Object Sample

[source,bash]
----
./run.sh -t 60 -l memory_allocation -p
----

5.3)

[source,bash]
----
./run.sh -l memory_allocation
----

Abrir el proceso con VisualVM y en el tab _Monitor_ opción `Heap Dump`

Luego Abrir el `Heap Dump` con MAT (Memory Analyzer Thread).


== Preguntas

1) ¿Qué clases se instancian más? ¿Donde? ¿Por qué?